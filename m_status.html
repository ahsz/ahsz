<!DOCTYPE html> 
<html> 
<head> 
	<meta charset="UTF-8">  </meta> 
	<title>Munka státusz</title>

	<style media="screen" type="text/css"> 

	textarea { 
		resize: none; 
	} 

	</style>
	<link rel="stylesheet" type="text/css" href="m_status.css">
	<script type="text/javascript" src='https://www.google.com/jsapi?autoload={"modules":[{"name":"visualization","version":"1.1","packages":["corechart"]}]}'></script>
	<script type="text/javascript">
		google.setOnLoadCallback(drawChart);
		// TODO bekért linket a DB-ből ideilleszteni
		var gitUrl = 'https://api.github.com/repos/ahsz/ahsz/';
		var dataTable_commit;
		var dataTable_linePerCommit;
		
		function initializeChart() {
			dataTable_commit = new google.visualization.DataTable();
			dataTable_commit.addColumn({ type: 'string', label: 'User' });
			dataTable_commit.addColumn({ type: 'number', label: 'Commitok' });
			dataTable_linePerCommit = new google.visualization.DataTable();
			dataTable_linePerCommit.addColumn({ type: 'string', label: 'User' });
			dataTable_linePerCommit.addColumn({ type: 'number', label: 'Hozzáadott sorok' });
			dataTable_linePerCommit.addColumn({ type: 'number', label: 'Törölt sorok' });
			dataTable_linePerCommit.addColumn({ type: 'number', label: 'Új sorok' });
			var script = document.createElement('script');  
			script.src = gitUrl + 'stats/contributors?callback=gitRoot';
			document.getElementsByTagName('head')[0].appendChild(script);
		}
		/**
		 * Git API válaszán keresztül a projekt alapinfóinak lekérdezése
		 */
		function gitRoot(response) {
			var data = response.data;
			// az egész kapott objektum kiiratásához szedd ki a kommentet
			//console.log(data);
			if(data.length > 1) {
				for (var i = 0; i < data.length; i++) {
					var user = data[i].author.login;
					var commits = data[i].total;
					dataTable_commit.addRow([user,commits]);
					dataTable_commit.sort([0,1]);
					
					var lineA = 0;
					var lineD = 0;
					var lineC = 0;
					for(var j = 0; j < data[i].weeks.length; j++) {
						lineA += data[i].weeks[j].a;
						lineD += data[i].weeks[j].d;
						lineC += data[i].weeks[j].a - data[i].weeks[j].d;
					}
					// kerekítés
					lineA = Math.round( 100 * lineA / commits ) / 100;
					lineD = Math.round( 100 * lineD / commits ) / 100;
					lineC = Math.round( 100 * lineC / commits ) / 100;
					dataTable_linePerCommit.addRow([user,lineA,lineD,lineC]);
					dataTable_linePerCommit.sort([0,1]);
					
				}
				drawChart();
			}
		}
		
		// ha nem akarjuk az elején kirajzoltatni a teljes félév adatát, akkor töröljük
		initializeChart();

		/**
		 * Google calendar chart kirajzoltatás
		 */
		function drawChart() {
			var chart_commit = new google.visualization.PieChart(document.getElementById('chart_commit'));
			var chart_linePerCommit = new google.visualization.ColumnChart(document.getElementById('chart_linePerCommit'));
			
			var options_commit = {
			 title: "Commitok aránya",
			 pieHole: 0.4,
			 height: 350,
			};
			var options_linePerCommit = {
			 title: "Commitonkénti átlagos értékek",
			 height: 350,
			};
			
			chart_commit.draw(dataTable_commit, options_commit);
			chart_linePerCommit.draw(dataTable_linePerCommit, options_linePerCommit);
		}
	</script>
	
</head>

<body>



	<div style="margin-left:200">
	
	<br><br>
	<h1>Munka státusz</h1>
	</div>
	<div id="chart_commit" style="width: 600px; height: 350px;"></div> <br>
	<div id="chart_linePerCommit" style="width: 600px; height: 350px;"></div>
	
	<ol class="tree">
		<li>
			<label for="date_1">2015.04.06.</label> <input type="checkbox" id="date_1" /> 
			<ol>
				<li>
					<label for="commit_1">Commit 1</label> <input type="checkbox" id="commit_1" /> 
					<ol>
						<li class="file"><a>person_name</a></li>
						<li class="file"><a>date</a></li>
						<li class="file"><a>modified_rows</a></li>
					</ol>
				</li>
			</ol>
		</li>

		<li>
			<label for="date_2">2015.04.07.</label> <input type="checkbox" id="date_2" /> 
			<ol>
				<li>
					<label for="commit_2">Commit 2</label> <input type="checkbox" id="commit_2" /> 
					<ol>
						<li class="file"><a>person_name</a></li>
						<li class="file"><a>date</a></li>
						<li class="file"><a>modified_rows</a></li>
					</ol>
				</li>
			</ol>
		</li>
	</ol>
	
	
</body>

</html>
